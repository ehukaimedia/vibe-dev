# Vibe Dev Session Handoff - Windows to Mac Migration

## For You (Human Coordinator)

### Context
The user (Arsen) was working on Windows where:
- Tests were failing due to incorrect imports
- `@lydell/node-pty` is installed but code still imports from 'node-pty'
- Build fails with TypeScript errors
- Integration tests have mocking issues

Now switched to Mac for proper development environment.

### Current Issues
1. **Import Mismatch**: Code imports 'node-pty' but package.json has '@lydell/node-pty'
2. **TypeScript Warning**: Need to set isolatedModules: true
3. **Mock Issues**: Mock file needs to mock '@lydell/node-pty' not 'node-pty'
4. **Integration Test**: Mocking issue in integration.test.ts

### Expected Outcome
- All tests pass (23/23)
- Build completes successfully
- MCP server can start
- No TypeScript errors or warnings

## For Claude Code - COPY THIS ENTIRE SECTION
```bash
cd /Users/ehukaimedia/Desktop/AI-Applications/Node/vibe-dev
git status
npm test

# Fix import in vibe-terminal.ts
sed -i '' "s/from 'node-pty'/from '@lydell\/node-pty'/g" src/vibe-terminal.ts

# Fix import in pty-test.ts
sed -i '' "s/from 'node-pty'/from '@lydell\/node-pty'/g" src/test/pty-test.ts

# Update mock to mock @lydell/node-pty
cat > src/__mocks__/@lydell/node-pty.ts << 'EOF'
export const MockIPty = {
  pid: 12345,
  onData: jest.fn(),
  onExit: jest.fn(),
  write: jest.fn(),
  resize: jest.fn(),
  kill: jest.fn(),
  destroy: jest.fn()
};

export const spawn = jest.fn().mockReturnValue(MockIPty);

export type IPty = typeof MockIPty;
EOF

# Update jest config to handle @lydell scope
cat > jest.config.js << 'EOF'
export default {
  preset: 'ts-jest',
  testEnvironment: 'node',
  moduleNameMapper: {
    '^(\\.{1,2}/.*)\\.js$': '$1',
    '^@lydell/node-pty$': '<rootDir>/src/__mocks__/@lydell/node-pty.ts'
  },
  transform: {
    '^.+\\.tsx?$': ['ts-jest', {
      useESM: true,
      isolatedModules: true
    }]
  },
  extensionsToTreatAsEsm: ['.ts'],
  testMatch: ['**/*.test.ts'],
  collectCoverageFrom: [
    'src/**/*.ts',
    '!src/**/*.test.ts',
    '!src/**/*.d.ts',
    '!src/test/**'
  ],
  coverageDirectory: 'coverage',
  coverageReporters: ['text', 'lcov', 'html']
};
EOF

# Fix TypeScript config
sed -i '' '/"compilerOptions": {/a\
    "isolatedModules": true,
' tsconfig.json

# Fix integration test mocking
sed -i '' 's/jest.mock.*vibe-terminal.*/jest.mock('\''\.\/vibe-terminal.js'\'', () => ({\
  VibeTerminal: jest.fn().mockImplementation(() => ({\
    execute: jest.fn().mockResolvedValue({\
      output: '\''Mock output'\'',\
      exitCode: 0,\
      sessionId: '\''mock-session-id'\'',\
      executionTime: 100\
    }),\
    getSessionState: jest.fn().mockReturnValue({\
      sessionId: '\''mock-session-id'\'',\
      shellType: '\''bash'\'',\
      startTime: new Date(),\
      commandCount: 0,\
      currentDirectory: '\''\/tmp'\''\
    }),\
    kill: jest.fn()\
  }))\
}));/g' src/integration.test.ts

# Ensure mock directory structure exists
mkdir -p src/__mocks__/@lydell

# Run tests to verify fixes
npm test

# If tests pass, build
npm run build

# If build succeeds, verify server can start
npm start
```